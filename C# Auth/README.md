# Auth Service Demo
–≠—Ç–æ –ø—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è **React + ASP.NET Core** —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ JWT, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **cookie**, —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ä–æ–ª—è–º –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–µ–π —Ä–∞–±–æ—Ç—ã API.
---
## üîπ Backend
### 1. Entity: 
- `User`
- `Role
---
### 2. AuthService
–°–µ—Ä–≤–∏—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –∑–∞–¥–∞—á–∏:

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** (`Register`):
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ login
- –•—ç—à–∏—Ä—É–µ—Ç –ø–∞—Ä–æ–ª—å —Å –ø–æ–º–æ—â—å—é BCrypt
- –°–æ–∑–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT —Ç–æ–∫–µ–Ω –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ –≤–º–µ—Å—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`AuthResponseDto`)
2. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** (`Login`):
- –ù–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ login
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–∞—Ä–æ–ª—å —á–µ—Ä–µ–∑ BCrypt
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT —Ç–æ–∫–µ–Ω –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
---
### 3. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
- **AuthController**: `/login`, `/register`, `/logout`, `/me`, `/validate`
- `/login` –∏ `/register` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç JWT –≤ **–∫—É–∫–∏**:
- `/me` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ç–æ–∫–µ–Ω–∞
- `/validate` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω

- **UserController**: `/profile`, `/info`
- –¢—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ `[Authorize]`
- –î–æ—Å—Ç—É–ø –∫ `/info` –º–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–æ–ª—è–º–∏ `[Authorize(Roles="User,Admin")]`

- **AdminController**: `/dashboard`, `/users`
- –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è `[Authorize(Roles="Admin")]`
---
### 4. JWT –∏ –∫—É–∫–∏
#### 1. –ó–∞–ø—Ä–æ—Å –Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

`[–§—Ä–æ–Ω—Ç–µ–Ω–¥] ‚Üí POST /login –∏–ª–∏ /register‚Üí [–ë—ç–∫–µ–Ω–¥]`
- –≠–Ω–¥–ø–æ–∏–Ω—Ç public - –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞
- AuthService –ø–æ–ª—É—á–∞–µ—Ç –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤ –ë–î

#### 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞

–≤ AuthService –º–µ—Ç–æ–¥ `GenerateJwtToken(User user)`

```
GenerateJwtToken(user)  // ‚Üê –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JwtSettings –∏–∑ DI
{
    –∫–ª—é—á = _jwt.SecretKey      // –¥–ª—è –ø–æ–¥–ø–∏—Å–∏
    issuer = _jwt.Issuer       // –∫—Ç–æ –≤—ã–ø—É—Å—Ç–∏–ª
    claims: claims
    audience = _jwt.Audience   // –¥–ª—è –∫–æ–≥–æ
    expires = _jwt.ExpireMinutes  // –∫–æ–≥–¥–∞ –∏—Å—Ç–µ—á–µ—Ç —Å—Ä–æ–∫ —Ä–∞–±–æ—Ç—ã —Ç–æ–∫–µ–Ω–∞
}

// claims - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–∫–µ–Ω (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ)
 var claims = new List<Claim>
 {
     new Claim(ClaimTypes.NameIdentifier, user.Id.ToString()),
     new Claim(ClaimTypes.Name, user.Login!),
     new Claim(ClaimTypes.Role, user.Role?.Name ?? "User"),
     new Claim("UserId", user.Id.ToString()),
     new Claim("RoleId", user.RoleId.ToString())
 };
```

–≤ `Startup.cs` –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è JWT
```
 var jwtSettings = new JwtSettings
 {
     SecretKey = "your-very-long-secret-key-at-least-32-characters-here", // —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á
     Issuer = "AuthService", // –∫—Ç–æ –≤—ã–ø—É—Å—Ç–∏–ª
     Audience = "AuthClient", // –¥–ª—è –∫–æ–≥–æ
     ExpireMinutes = 60 // –∫–æ–≥–¥–∞ –∏—Å—Ç–µ—á–µ—Ç —Å—Ä–æ–∫ —Ä–∞–±–æ—Ç—ã —Ç–æ–∫–µ–Ω–∞

 };
```
 
#### 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–ª–∏–µ–Ω—Ç—É

–≤ AuthController –≤ /login, /register

```
 Response.Cookies.Append("auth_token", response.Token, new CookieOptions
 {
     HttpOnly = true,
     Secure = true,
     SameSite = SameSiteMode.Strict,
     Expires = response.Expires
 });
return Ok
```
#### 4. –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã
```
[–§—Ä–æ–Ω—Ç–µ–Ω–¥] ‚Üí GET /me (c –∫—É–∫–∏ auth_token) ‚Üí [ASP.NET Core]
                                          ‚Üì
                              JwtBearerMiddleware (–ø–µ—Ä–µ—Ö–≤–∞—Ç!)
```
JwtBearerMiddleware - —á–∞—Å—Ç—å ASP.NET, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É —Ç–æ–∫–µ–Ω–∞

JwtBearerMiddleware –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –î–æ—Å—Ç–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ –∫—É–∫–∏ (OnMessageReceived)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å (IssuerSigningKey)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏–∑–¥–∞—Ç–µ–ª—è (ValidIssuer)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è (ValidAudience)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ä–æ–∫ (exp)
- –ï—Å–ª–∏ –≤—Å—ë –æ–∫ - –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –¥–∞–ª—å—à–µ –∫ –∫–ª–∞—Å—Å–∞–º Controller, Service

–ë—ç–∫–µ–Ω–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª–∏ —á–µ—Ä–µ–∑ [Authorize(Roles="Admin")], —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–∞–Ω–µ–ª–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω—É–∂–Ω–æ–π —Ä–æ–ª–∏

#### –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
–ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å `/logout` –æ—á–∏—â–∞—é—Ç—Å—è –∫—É–∫–∏ 
```
 [HttpPost("/logout")]
 [Authorize]
 public IActionResult Logout()
 {
     Response.Cookies.Delete("auth_token");
     return Ok(new { message = "–í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã" });
 }
```
–Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### Frontend
–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—É–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥, —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ apiFetch:

`const API_URL = "https://localhost:7093";`


```
export async function apiFetch(url, options = {}) {
   const response = await fetch(`${API_URL}${url}`, {
       ...options,
       credentials: "include", // üî• –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è cookie
       headers: { "Content-Type": "application/json", ...(options.headers || {}) }

   });
   if (!response.ok) {
       const error = await response.json();
       throw new Error(error.message || "API error");
   }
   return response.json();

}
```
–≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–µ—Ç–æ–¥—ã:

- `login(login, password)`
- `register(name, login, password)`
- `logout()`
- `me()` - –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `adminDashboard()` - –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ Admin
- `userProfile()`  - –¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –≤—Å–µ—Ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    1. POST /login      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ö–ª–∏–µ–Ω—Ç  ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> ‚îÇ          ‚îÇ
‚îÇ         ‚îÇ                        ‚îÇ          ‚îÇ
‚îÇ         ‚îÇ    2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT    ‚îÇ  Auth    ‚îÇ
‚îÇ         ‚îÇ     (AuthService)      ‚îÇ Service  ‚îÇ
‚îÇ         ‚îÇ                        ‚îÇ          ‚îÇ
‚îÇ         ‚îÇ    3. Cookie: token    ‚îÇ          ‚îÇ
‚îÇ         ‚îÇ <‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ                                   ‚ñ≤
     ‚îÇ 4. GET /me (c cookie)            ‚îÇ
     ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ                              [JwtBearer]
     ‚îÇ                              –ü—Ä–æ–≤–µ—Ä–∫–∞:
     ‚îÇ                              ‚úì –ü–æ–¥–ø–∏—Å—å
     ‚îÇ                              ‚úì –°—Ä–æ–∫
     ‚îÇ                              ‚úì Issuer/Audience
     ‚îÇ
     ‚ñº
[HttpContext.User] ‚Üê —Å–æ–∑–¥–∞–Ω –∏–∑ —Ç–æ–∫–µ–Ω–∞
```

### 5. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ä–æ–ª—è–º

–§—Ä–æ–Ω—Ç–µ–Ω–¥ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ /me –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `user`, –ø–æ `role` –≤–Ω—É—Ç—Ä–∏ `user` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–æ–ª—å –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
```
{user.role === "Admin" && <AdminPanel />}
<UserPanel /> // –¥–ª—è –≤—Å–µ—Ö
```

Backend –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ —á–µ—Ä–µ–∑ [Authorize(Roles="Admin")] –∏ [Authorize(Roles="User,Admin")]

## DEMO
![1](img/1.png)
![2](img/2.png)
![3](img/3.png)