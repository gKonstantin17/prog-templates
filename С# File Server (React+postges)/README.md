# üìÅ File Server API —Å PostgreSQL

–§–∞–π–ª–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

.NET 8, c –ø–∞–∫–µ—Ç–∞–º–∏ NuGet:

* `Microsoft.EntityFrameworkCore`
* `Microsoft.EntityFrameworkCore.Tools`
* `Microsoft.EntityFrameworkCore.Design`
* –í —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å postgres: `Npgsql.EntityFrameworkCore.PostgreSQL`

`Scrutor` –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ `dotnet add package Scrutor`

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–î

–≤ —Ñ–∞–π–ª–µ `Startup.cs` —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```var connectionString = "Server=localhost;Port=5432;Database=file-service;User Id=postgres;Password=rootroot;";```
## –ú–∏–≥—Ä–∞—Ü–∏—è
**–æ–±–Ω–æ–≤–∏—Ç—å Visual Studio –∏ .net (sdk)**

–í –ø—Ä–æ–µ–∫—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª (ctrl + —ë)

–ø—Ä–æ–ø–∏—Å–∞—Ç—å:
``` 
cd [–Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞]
 dotnet ef migrations add InitialCreate
 dotnet ef database update
```
## –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è

–≤ —Ñ–∞–π–ª–µ `Startup.cs` –º–µ—Ç–æ–¥ `CreateUploadDirectories()`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤:

```
wwwroot/
‚îî‚îÄ‚îÄ uploads/
	 ‚îú‚îÄ‚îÄ files/      # –í—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
	 ‚îÇ   ‚îú‚îÄ‚îÄ –¥–æ–∫—É–º–µ–Ω—Ç\\\_20231201120000.pdf
	 ‚îÇ   ‚îî‚îÄ‚îÄ –∞—Ä—Ö–∏–≤\\\_20231201120100.zip
	 ‚îî‚îÄ‚îÄ photos/     # –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
	     ‚îú‚îÄ‚îÄ photo1\\\_20231201120200.jpg
	     ‚îî‚îÄ‚îÄ photo2\\\_20231201120300.png
```
## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
FileServer/
‚îú‚îÄ‚îÄ Controllers/           # API –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ FileController.cs  # API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ UserController.cs  # API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îú‚îÄ‚îÄ Entity/               # –°—É—â–Ω–æ—Å—Ç–∏ –∏ DTO
‚îÇ   ‚îú‚îÄ‚îÄ FileData.cs       # –ú–æ–¥–µ–ª—å —Ñ–∞–π–ª–∞
‚îÇ   ‚îî‚îÄ‚îÄ User.cs          # –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ Repository/          # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (–¥–æ—Å—Ç—É–ø –∫ –ë–î)
‚îÇ   ‚îú‚îÄ‚îÄ FileRepository.cs
‚îÇ   ‚îî‚îÄ‚îÄ UserRepository.cs
‚îú‚îÄ‚îÄ Service/            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ FileService.cs  # –°–µ—Ä–≤–∏—Å —Ñ–∞–π–ª–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ UserService.cs  # –°–µ—Ä–≤–∏—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ wwwroot/           # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îî‚îÄ‚îÄ uploads/       # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ       ‚îú‚îÄ‚îÄ files/     # –û–±—ã—á–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ       ‚îî‚îÄ‚îÄ photos/    # –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
‚îú‚îÄ‚îÄ Program.cs         # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ Startup.cs         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ ApplicationContext.cs # –ö–æ–Ω—Ç–µ–∫—Å—Ç –ë–î
‚îî‚îÄ‚îÄ FileServer.csproj  # –§–∞–π–ª –ø—Ä–æ–µ–∫—Ç–∞
```
## üåê API Endpoints
### üë§ User API (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ | –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ | –û—Ç–≤–µ—Ç | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã |
|-------|----------|----------|--------------|-------|-----------|
| `POST` | `/register` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | `{"name":"string","login":"string","password":"string"}` | `User` –æ–±—ä–µ–∫—Ç | - |
| `POST` | `/login` | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | `{"login":"string","password":"string"}` | `User` –æ–±—ä–µ–∫—Ç –∏–ª–∏ `null` | - |
| `GET` | `/{id}` | –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID | - | `User` –æ–±—ä–µ–∫—Ç (–±–µ–∑ –ø–∞—Ä–æ–ª—è) | `id: long` |
### üìÅ File API (–§–∞–π–ª—ã)
| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ | –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ | –û—Ç–≤–µ—Ç | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã |
|-------|----------|----------|--------------|-------|-----------|
| `GET`| `/files` | –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ | - | `FileData\[]` –º–∞—Å—Å–∏–≤ | - |
| `GET`| `/download/{id}` | –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª –ø–æ ID | - | –§–∞–π–ª (–±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ) | `id: long` |
| `POST` | `/upload-file` | –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä | FormData: `file` (IFormFile) | `FileData` –æ–±—ä–µ–∫—Ç | - |
| `POST` | `/upload-photo` | –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | FormData: `userId` (long), `file` (IFormFile) | `FileData` –æ–±—ä–µ–∫—Ç | - |
| `POST` | `/delete-photo` | –£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | `User` –æ–±—ä–µ–∫—Ç | `boolean` (—É—Å–ø–µ—Ö/–Ω–µ—É–¥–∞—á–∞) | - |
| `DELETE` | `/delete/{id}` | –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª | - | `{"message": "string"}` | `id: long` |

## üóÉÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
### üìä –¢–∞–±–ª–∏—Ü–∞ `FileData` (—Ñ–∞–π–ª—ã)

| –ü–æ–ª–µ | –¢–∏–ø | Nullable | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏—è |
|------|-----|----------|----------|-----------------|
| `Id`| `long` | ‚ùå | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á, –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç | `1` |
| `Name` | `string` | ‚úÖ | –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ | `"–¥–æ–∫—É–º–µ–Ω—Ç.pdf"` |
| `RealName` | `string` | ‚úÖ | –§–∏–∑–∏—á–µ—Å–∫–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ –Ω–∞ –¥–∏—Å–∫–µ | `"–¥–æ–∫—É–º–µ–Ω—Ç\_20231201120000.pdf"` |
| `Path` | `string` | ‚úÖ | –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É | `"uploads/files/–¥–æ–∫—É–º–µ–Ω—Ç\_20231201120000.pdf"` |
| `UploadDate` | `DateTime` | ‚úÖ | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ (UTC) | `2023-12-01T12:00:00Z` |
| `Type`| `string` | ‚úÖ | MIME-—Ç–∏–ø —Ñ–∞–π–ª–∞ | `"application/pdf"` |
| `Size` | `long` | ‚úÖ | –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ –±–∞–π—Ç–∞—Ö | `1048576` (1 MB) |
| `IsDeleted` | `bool` | ‚úÖ | –§–ª–∞–≥ –º—è–≥–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è | `false` |

### üë§ –¢–∞–±–ª–∏—Ü–∞ `User` (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
| –ü–æ–ª–µ | –¢–∏–ø | Nullable | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏—è |
|------|-----|----------|----------|-----------------|
| `Id` | `long` | ‚ùå | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á, –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç | `1` |
| `Name` | `string` | ‚úÖ | –ü–æ–ª–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | `"–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤"` |
| `Login` | `string` | ‚úÖ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –ª–æ–≥–∏–Ω –¥–ª—è –≤—Ö–æ–¥–∞ | `"ivanov"` |
| `Password` | `string` | ‚úÖ | –ü–∞—Ä–æ–ª—å (–≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ) | `"secure123"` |
| `Photo` | `string` | ‚úÖ | –ü—É—Ç—å –∫ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è | `"uploads/photos/photo\_20231201120000.jpg"` |

## Demo
![1](img/1.png)
![2](img/2.png)
![3](img/3.png)

